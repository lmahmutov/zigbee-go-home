{{template "layout" .}}
{{define "content"}}
<!-- Summary bar -->
<div class="summary-bar">
    <div class="summary-badge">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
            <rect x="4" y="4" width="16" height="16" rx="2"/>
            <rect x="9" y="9" width="6" height="6" rx="1"/>
        </svg>
        <span class="badge-count" id="total-count">{{.DeviceCount}}</span> <span data-i18n="overview.devices">devices</span>
    </div>
    <div class="summary-badge online">
        <span class="badge-count" id="online-count">{{.DeviceCount}}</span> <span data-i18n="overview.online">online</span>
    </div>
    <div class="summary-badge offline">
        <span class="badge-count" id="offline-count">0</span> <span data-i18n="overview.offline">offline</span>
    </div>
</div>

<!-- Device tiles -->
{{if .Devices}}
<div class="device-grid" id="device-grid">
    {{range .Devices}}
    <a href="/devices/{{.IEEEAddress}}" class="device-tile" data-ieee="{{.IEEEAddress}}" data-type="{{.DeviceType}}">
        <div class="device-tile-header">
            <div class="device-icon" id="icon-{{.IEEEAddress}}">
                {{if eq .DeviceType "light"}}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 18h6"/>
                    <path d="M10 22h4"/>
                    <path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0018 8 6 6 0 006 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 018.91 14"/>
                </svg>
                {{else if eq .DeviceType "switch"}}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 2v6"/>
                    <circle cx="12" cy="14" r="8"/>
                    <circle cx="12" cy="14" r="3"/>
                </svg>
                {{else if eq .DeviceType "sensor"}}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 4v10.54a4 4 0 11-4 0V4a2 2 0 014 0z"/>
                </svg>
                {{else if eq .DeviceType "thermostat"}}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 4v10.54a4 4 0 11-4 0V4a2 2 0 014 0z"/>
                    <line x1="8" y1="9" x2="6" y2="9"/>
                    <line x1="8" y1="13" x2="6" y2="13"/>
                </svg>
                {{else}}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="4" y="4" width="16" height="16" rx="2"/>
                    <rect x="9" y="9" width="6" height="6" rx="1"/>
                </svg>
                {{end}}
            </div>
            <div class="device-tile-info">
                <div class="device-tile-name">
                    {{if .FriendlyName}}{{.FriendlyName}}{{else if and .Manufacturer .Model}}{{.Manufacturer}} {{.Model}}{{else}}{{.IEEEAddress}}{{end}}
                </div>
                <div class="device-tile-model">
                    {{if and .Manufacturer .Model}}{{.Manufacturer}} / {{.Model}}{{else}}{{.IEEEAddress}}{{end}}
                </div>
            </div>
        </div>
        <div class="device-tile-body">
            <span class="device-tile-state" id="state-{{.IEEEAddress}}" data-has-onoff="{{.HasOnOff}}">
                {{if .HasOnOff}}--{{else if ne .Occupancy ""}}{{if eq .Occupancy "detected"}}<span data-i18n="state.motion">Motion</span>{{else}}<span data-i18n="state.clear">Clear</span>{{end}}{{else if ne .Contact ""}}{{if eq .Contact "open"}}<span data-i18n="state.open">Open</span>{{else}}<span data-i18n="state.closed">Closed</span>{{end}}{{else if .HasTemperature}}{{.Temperature}}&deg;C{{else if .HasIlluminance}}{{.Illuminance}} lx{{else if .HasHumidity}}{{.Humidity}}%{{else if eq .DeviceType "sensor"}}--{{else}}{{.DeviceType}}{{end}}
            </span>
            <span class="device-tile-badges">
                {{if ge .BatteryPercent 0}}
                <span class="badge-battery{{if le .BatteryPercent 10}} low{{end}}" data-ieee="{{.IEEEAddress}}" data-prop="battery">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12"><rect x="1" y="6" width="18" height="12" rx="2"/><line x1="23" y1="10" x2="23" y2="14"/></svg>
                    {{.BatteryPercent}}%
                </span>
                {{end}}
                {{if ne .LQIQuality ""}}
                <span class="badge-lqi {{.LQIQuality}}" data-ieee="{{.IEEEAddress}}" data-prop="lqi">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12">
                        <rect x="2" y="16" width="3" height="6" rx="1" fill="currentColor"/>
                        <rect x="8" y="11" width="3" height="11" rx="1" {{if or (eq .LQIQuality "fair") (eq .LQIQuality "good")}}fill="currentColor"{{end}}/>
                        <rect x="14" y="6" width="3" height="16" rx="1" {{if eq .LQIQuality "good"}}fill="currentColor"{{end}}/>
                    </svg>
                </span>
                {{end}}
            </span>
            {{if .HasOnOff}}
            <label class="toggle" onclick="event.preventDefault(); event.stopPropagation();">
                <input type="checkbox" id="toggle-{{.IEEEAddress}}"
                       onchange="toggleDevice('{{.IEEEAddress}}', {{.PrimaryEndpoint}}, this.checked)">
                <span class="toggle-slider"></span>
            </label>
            {{end}}
        </div>
        <div class="device-tile-footer">
            <span class="last-seen" data-time="{{.LastSeen.Unix}}">{{.LastSeen.Format "15:04:05"}}</span>
            {{if .Interviewed}}
            <span class="badge badge-success" data-i18n="overview.interviewed">Interviewed</span>
            {{else}}
            <span class="badge badge-warning" data-i18n="overview.pending">Pending</span>
            {{end}}
        </div>
    </a>
    {{end}}
</div>
{{else}}
<div class="empty-state">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <rect x="4" y="4" width="16" height="16" rx="2"/>
        <line x1="12" y1="8" x2="12" y2="16"/>
        <line x1="8" y1="12" x2="16" y2="12"/>
    </svg>
    <p data-i18n="overview.no_devices">No devices paired yet</p>
    <button class="btn btn-primary" onclick="permitJoin(120)" data-i18n="overview.open_permit_join">Open Permit Join</button>
</div>
{{end}}

<!-- Recent events -->
<div class="section mt-16">
    <h2 class="section-title" data-i18n="overview.recent_events">Recent Events</h2>
    <div class="events-log" id="events-log">
        <div class="event muted" id="events-placeholder" data-i18n="overview.waiting_events">Waiting for events...</div>
    </div>
</div>
{{end}}
