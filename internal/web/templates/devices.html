{{template "layout" .}}
{{define "content"}}
<!-- Search and actions bar -->
<div class="search-bar">
    <div class="search-wrapper">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"/>
            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
        <input type="text" class="search-input" id="device-search"
               placeholder="Search devices..." data-i18n-placeholder="devices.search_placeholder" oninput="filterDevices(this.value)">
    </div>
    <button class="btn btn-primary" onclick="permitJoin(120)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="16"/>
            <line x1="8" y1="12" x2="16" y2="12"/>
        </svg>
        <span data-i18n="devices.pair_new">Pair New Device</span>
    </button>
</div>

{{if .Devices}}
<div class="device-grid" id="device-list">
    {{range .Devices}}
    <a href="/devices/{{.IEEEAddress}}" class="device-tile"
       data-ieee="{{.IEEEAddress}}"
       data-name="{{.FriendlyName}} {{.Manufacturer}} {{.Model}}"
       data-type="{{.DeviceType}}">
        <div class="device-tile-header">
            <div class="device-icon">
                {{if eq .DeviceType "light"}}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 18h6"/><path d="M10 22h4"/>
                    <path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0018 8 6 6 0 006 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 018.91 14"/>
                </svg>
                {{else if eq .DeviceType "switch"}}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 2v6"/><circle cx="12" cy="14" r="8"/><circle cx="12" cy="14" r="3"/>
                </svg>
                {{else if eq .DeviceType "sensor"}}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 4v10.54a4 4 0 11-4 0V4a2 2 0 014 0z"/>
                </svg>
                {{else}}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="4" y="4" width="16" height="16" rx="2"/>
                    <rect x="9" y="9" width="6" height="6" rx="1"/>
                </svg>
                {{end}}
            </div>
            <div class="device-tile-info">
                <div class="device-tile-name">
                    {{if .FriendlyName}}{{.FriendlyName}}{{else if and .Manufacturer .Model}}{{.Manufacturer}} {{.Model}}{{else}}{{.IEEEAddress}}{{end}}
                </div>
                <div class="device-tile-model">{{.IEEEAddress}}</div>
            </div>
        </div>
        <div class="device-tile-body">
            <span class="device-tile-state muted">
                {{if and .Manufacturer .Model}}{{.Manufacturer}} / {{.Model}}{{else}}<span data-i18n="devices.unknown">Unknown device</span>{{end}}
            </span>
        </div>
        <div class="device-tile-footer">
            <span class="last-seen" data-time="{{.LastSeen.Unix}}">{{.LastSeen.Format "15:04:05"}}</span>
            {{if ge .BatteryPercent 0}}
            <span class="badge-battery{{if le .BatteryPercent 10}} low{{end}}" data-ieee="{{.IEEEAddress}}" data-prop="battery">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12"><rect x="1" y="6" width="18" height="12" rx="2"/><line x1="23" y1="10" x2="23" y2="14"/></svg>
                {{.BatteryPercent}}%
            </span>
            {{end}}
            {{if ne .LQIQuality ""}}
            <span class="badge-lqi {{.LQIQuality}}" data-ieee="{{.IEEEAddress}}" data-prop="lqi">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12">
                    <rect x="2" y="16" width="3" height="6" rx="1" fill="currentColor"/>
                    <rect x="8" y="11" width="3" height="11" rx="1" {{if or (eq .LQIQuality "fair") (eq .LQIQuality "good")}}fill="currentColor"{{end}}/>
                    <rect x="14" y="6" width="3" height="16" rx="1" {{if eq .LQIQuality "good"}}fill="currentColor"{{end}}/>
                </svg>
                {{.LQI}}
            </span>
            {{end}}
            {{if .Interviewed}}
            <span class="badge badge-success" data-i18n="devices.interviewed">Interviewed</span>
            {{else}}
            <span class="badge badge-warning" data-i18n="devices.pending">Pending</span>
            {{end}}
            <button class="btn-icon btn-delete-small" onclick="event.preventDefault(); event.stopPropagation(); deleteDevice('{{.IEEEAddress}}')" title="Delete device">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6"/>
                    <path d="M10 11v6"/><path d="M14 11v6"/>
                </svg>
            </button>
        </div>
    </a>
    {{end}}
</div>
{{else}}
<div class="empty-state">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <rect x="4" y="4" width="16" height="16" rx="2"/>
        <line x1="12" y1="8" x2="12" y2="16"/>
        <line x1="8" y1="12" x2="16" y2="12"/>
    </svg>
    <p data-i18n="devices.no_devices">No devices paired yet. Open permit join to add devices.</p>
    <button class="btn btn-primary" onclick="permitJoin(120)" data-i18n="devices.open_permit_join">Open Permit Join</button>
</div>
{{end}}
{{end}}
